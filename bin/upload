#!/usr/bin/env bash

USAGE="Usage: \"bin/upload\" MAIN PORT\n  where MAIN = primary, secondary or test/*\n  note: find PORT using \"bin/ports\"\n"
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"
PORT=$2

if [ -z "$1" ]; then
	printf "$USAGE"
	exit
fi

if [ -z "$PORT" ]; then
	PORT="$($DIR/ports | head -n 1)"
	printf "\e[1;35mUsing detected port $PORT\e[0m\n"
fi

$DIR/prep $1
$DIR/arduino-cmd --upload --port "/dev/tty$PORT" --preserve-temp-files
